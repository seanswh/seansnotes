Ray Trace 3 相交计算

我们会讲解三角形、球与光线的求交。并会讲到多边形和一般的隐式曲面（implicit surface）与光线的求交。
1。球
![](/Computer_Graphics/images/48.png)
光线是这样定义的：有一个起点P0和方向P1，t是沿着光线的大于等于0的参数，对应于沿着光线的距离。球用球心位置C来定位，对于球表面上的任何点P，P - C 与它自己的点积等于r的平方，其中r是半径。而我们想求的是交点的坐标。
把光线方程代入球的方程。在这个例子中，P = P0 + P1*t。我把它代入球的方程中。即：P0 + P1 * t - C与自己的点积等于r的平方。
进行简化，一个简单的二次方程（如下图）用于求解t。
![](/Computer_Graphics/images/49.png)

1.如果有2个正实根，意味着光线与球这样相交。在这种情况下，选择小的正实根。
2.如果两个根相同，意味着光线与球仅相交一次即光线与球相切。
3.如果有1正1负两个根，意味着光线起点在球里，负根对应这个交点，正根是这个交点。在这种情况下，选择正根，因为光线的参数t不会小于0。
4.如果有复根，意味着光线与球没有交点。
你应该确定判别式非负。最终你通过求解方程得到交点的参数t值。然后你需要找到真正的交点坐标。把求得的t代回方程 P0 + P1 * t，你可能还需要知道交点的法向，在球的例子中，你知道球表面某点的法向是从球心指向该点的方向，即 P - C，进行归一化。