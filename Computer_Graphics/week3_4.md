Ray Trace4 效率优化
我们来看光线追踪的一个被广泛研究的领域，即加速结构。对于一条光线，你希望检测尽可能少的物体，理想时只检测会相交的那个。实际中并不可能，不过我们经常可以使求交次数降到物体总数的对数量级。让我们先考虑不同层次的包围盒，![](/Computer_Graphics/images/52.png)
如果光线没与整体的包围盒相交，记住，有很高效的光线与长方体的求交测试方法，那么就不用与包围盒中的各物体进行求交测试了。同样可以考虑组织包围盒的空间层次结构。如八叉树（oct-trees），k-维树（kd trees），BSP树（BSP tree）。
另一种加速结构是网格，可以是规则的网格或分层网格，目前我们只考虑规则网格。在网格中进行跟踪，
![](/Computer_Graphics/images/53.PNG)
先进入第一个网格单元，发现没有相交。注意，遍历网格看起来不规则，实际上这有沿着这儿的两根轴之一或三维中的三根轴之一的规则的交点，因此你可以很容易地通过增量方式计算下一个单元中的下一个交点。我进入下一个单元，每个单元有一个指针指向所有与该单元相交的物体。下一个单元，再下一个单元，现在我们发现有一个可能相交的情况需要检测，所以我需要检测光线与该物体是否相交，但实际并没有相交。往下走，到这里。同样我需要测试这个物体，未相交，继续。最终得到了实际相交的物体。
一个需要提示的有趣的地方是这边的两个物体（左下和右上的两个大圆），从未被检测过，
不需要对它们进行相交测试，所以未在遍历路径上的空间中很大一部分实际上永远不用进行光线和表面间的相交测试。
规则网格是最简单的加速结构，例如5×5×5的网格。对每个网格单元，存储所有与之相交的三角形，沿网格前进，